<!DOCTYPE html>
<html lang="<%= I18n.locale %>" dir="<%= page_dir %>">
  <head>
    <title><%= content_for(:title) || t('app_name') %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_include_tag "/assets/application", "data-turbo-track": "reload", type: "module" %>
  </head>

  <body class="<%= 'rtl' if page_dir == 'rtl' %>">
  <!-- Header -->
  <header class="fixed inset-x-0 top-0 z-50 bg-white/80 backdrop-blur border-b">
    <div class="container mx-auto px-5 h-16 flex items-center justify-between">
      <% logo = I18n.locale.to_s == "ar" ? "/Bisan_ar.png" : "/Bisan_2.png" %>
      <% logo_class = I18n.locale.to_s == "ar" ? "h-18 w-auto" : "h-15 w-auto" %>
      <%= link_to root_path do %>
        <%= image_tag(logo, alt: t("app_name"), class: logo_class) %>
      <% end %>


      <!-- Main nav (centered) -->
      <nav>
        <ul class="flex items-center gap-6 text-base font-medium text-gray-800">
          <!-- Articles tab -->
          <li>
            <%= link_to t("nav_articles", default: "المقالات"),
                        articles_path,
                        class: "hover:text-black transition #{current_page?(articles_path) ? 'text-black' : 'text-gray-700'}" %>
          </li>

          <!-- Authors tab -->
          <li>
            <%= link_to t("nav_authors", default: "الكُتّاب"),
                        authors_path,
                        class: "hover:text-black transition #{current_page?(authors_path) ? 'text-black' : 'text-gray-700'}" %>
          </li>
        </ul>
      </nav>

      <!-- Locale switcher -->
      <nav aria-label="Language">
        <ul class="flex items-center gap-2 list-none m-0 p-0">
          <% I18n.available_locales.each do |locale| %>
            <li>
              <% active = I18n.locale == locale %>
              <% label  = t(locale, scope: "locales", default: locale.to_s.upcase) %>

              <% if active %>
                <span
                  aria-current="page"
                  class="inline-flex items-center rounded-full border border-gray-300 bg-gray-100 px-3 py-1 text-sm font-medium text-gray-900"
                  title="<%= label %>"
                >
                  <%= label %>
                </span>
              <% else %>
                <%= link_to label,
                            url_for(locale: locale),
                            class: "inline-flex items-center rounded-full border border-gray-300 px-3 py-1 text-sm font-medium text-gray-700 hover:bg-gray-50 transition",
                            hreflang: locale,
                            lang: locale %>
              <% end %>
            </li>
          <% end %>
        </ul>
      </nav>
    </div>
  </header>

  <!-- Content -->
  <main class="container mx-auto mt-28 px-5">
    <%= yield %>
  </main>

    <!-- Footer -->
  <footer class="mt-16 border-t bg-white">
    <div class="container mx-auto px-5 py-6 flex flex-col md:flex-row items-center justify-between text-sm text-gray-600">
      
      <!-- Copyright -->
      <div class="mb-4 md:mb-0 text-center md:text-left">
        © 2024–2025 <%= t("app_name", default: "Bisan") %>. <%= t("all_rights_reserved", default: "All rights reserved.") %> |
        <%= link_to t("privacy_policy", default: "Privacy Policy"), "/privacy", class: "hover:underline" %>
      </div>
    </div>
  </footer>

</body>
</html>
