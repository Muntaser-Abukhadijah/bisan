<!DOCTYPE html>
<html lang="<%= I18n.locale %>" dir="<%= page_dir %>">
  <head>
    <title><%= content_for(:title) || t('app_name') %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", type: "module" %>
  </head>

  <body class="<%= 'rtl' if page_dir == 'rtl' %>">
  <!-- Header -->
  <header class="fixed inset-x-0 top-0 z-50 bg-white/80 backdrop-blur border-b">
    <div class="container mx-auto px-5 h-16 flex items-center justify-between">
      <% logo = I18n.locale.to_s == "ar" ? "/Bisan_ar.png" : "/Bisan_2.png" %>
      <% logo_class = I18n.locale.to_s == "ar" ? "h-16 w-auto" : "h-12 w-auto" %>
      <%= link_to root_path do %>
        <%= image_tag(logo, alt: t("app_name"), class: logo_class) %>
      <% end %>


      <!-- Main nav (centered) -->
      <nav>
        <ul class="flex items-center gap-6 text-base font-medium text-gray-800">
          <!-- Articles tab -->
          <li>
            <%= link_to articles_path,
                        class: "flex items-center gap-2 hover:text-black transition #{current_page?(articles_path) ? 'text-black' : 'text-gray-700'}" do %>
              <%= heroicon "newspaper", options: { class: "w-5 h-5" }, variant: :outline %>
              <%= t("nav_articles", default: "المقالات") %>
            <% end %>
          </li>

          <!-- Authors tab -->
          <li>
            <%= link_to authors_path,
                        class: "flex items-center gap-2 hover:text-black transition #{current_page?(authors_path) ? 'text-black' : 'text-gray-700'}" do %>
              <%= heroicon "users", options: { class: "w-5 h-5" }, variant: :outline %>
              <%= t("nav_authors", default: "الكُتّاب") %>
            <% end %>
          </li>
        </ul>
      </nav>

      <!-- Locale switcher dropdown -->
      <div class="relative" data-controller="dropdown">
        <% current_label = t(I18n.locale, scope: "locales", default: I18n.locale.to_s.upcase) %>
        <button
          data-action="click->dropdown#toggle"
          class="inline-flex items-center gap-2 rounded-full border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 transition"
          aria-label="<%= t('select_language', default: 'Select Language') %>"
        >
          <%= heroicon "language", options: { class: "w-5 h-5" }, variant: :outline %>
          <span><%= current_label %></span>
          <%= heroicon "chevron-down", options: { class: "w-4 h-4" }, variant: :outline %>
        </button>

        <!-- Dropdown Menu -->
        <div
          data-dropdown-target="menu"
          class="hidden absolute right-0 mt-2 w-48 rounded-lg shadow-lg bg-white border border-gray-200 py-1 z-50"
        >
          <% I18n.available_locales.each do |locale| %>
            <% active = I18n.locale == locale %>
            <% label = t(locale, scope: "locales", default: locale.to_s.upcase) %>
            
            <%= link_to url_for(locale: locale),
                        class: "flex items-center justify-between px-4 py-2 text-sm #{active ? 'bg-gray-50 text-black font-medium' : 'text-gray-700 hover:bg-gray-100'}",
                        hreflang: locale,
                        lang: locale,
                        data: { turbo: false } do %>
              <span><%= label %></span>
              <% if active %>
                <%= heroicon "check", options: { class: "w-4 h-4 text-green-600" }, variant: :outline %>
              <% end %>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </header>

  <!-- Content -->
  <main class="container mx-auto mt-28 px-5">
    <%= yield %>
  </main>

    <!-- Footer -->
  <footer class="mt-16 border-t bg-white">
    <div class="container mx-auto px-5 py-6 flex flex-col md:flex-row items-center justify-between text-sm text-gray-600">
      
      <!-- Copyright -->
      <div class="mb-4 md:mb-0 text-center md:text-left">
        © 2024–2025 <%= t("app_name", default: "Bisan") %>. <%= t("all_rights_reserved", default: "All rights reserved.") %> |
        <%= link_to t("privacy_policy", default: "Privacy Policy"), "/privacy", class: "hover:underline" %>
      </div>
    </div>
  </footer>

</body>
</html>
